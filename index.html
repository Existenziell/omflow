<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Omflow World Map</title>
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	
	<link rel="icon" type="image/png" sizes="192x192" href="img/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="img/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
	<link rel="manifest" href="img/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="img/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

	<script language="javascript" src="data/places.json"></script> 
	<script src="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.js"></script>
	<link href="https://api.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css" rel="stylesheet" />
	<link rel="stylesheet" href="css/main.css" />
</head>
<body>
	<div id="overlay">
		<div class="overlay-button">
			<a href="javascript:void(0)" onclick="hideOverlay();">LOCATE AN OMIE</a>
		</div>
		<div class="overlay-button">
			<a href="matchme.html">LET'S OMFLOW</a>
		</div>
	</div>
	<div id="map"></div>
	<script>
		mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
		var map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/satellite-v9', // satellite-v9 / light-v10 / dark-v10 / outdoors-v11
			// center: [-77.04, 38.907],
			zoom: 1.5
		});

		// Add geolocate control to the map.
		map.addControl(
			new mapboxgl.GeolocateControl({
				positionOptions: {
					enableHighAccuracy: true
				},
				trackUserLocation: true
			})
		);

		// Map JSON data from places.json into JS object
		var places = places;

		map.on('load', function() {
			map.addSource('places', places);
			/* Image: An image is loaded and added to the map. */
			map.loadImage("img/logo30.png", function(error, image) {
				if (error) throw error;
				map.addImage("custom-marker", image);
			});

			// Add a layer showing the places.
			map.addLayer({
				'id': 'places',
				'type': 'symbol',
				'source': 'places',
				'layout': {
					'icon-image': 'custom-marker',
					'icon-allow-overlap': true
				}
			});

			// Create a popup, but don't add it to the map yet.
			var popup = new mapboxgl.Popup({
				closeButton: true,
				closeOnClick: true,
				offset: 5
			});

			map.on('mouseenter', 'places', function(e) {
				map.getCanvas().style.cursor = 'pointer';

				var coordinates = e.features[0].geometry.coordinates.slice();
				var name = e.features[0].properties.name;
				var video = e.features[0].properties.video;
				var description = e.features[0].properties.description;

				// Ensure that if the map is zoomed out such that multiple
				// copies of the feature are visible, the popup appears
				// over the copy being pointed to.
				while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
					coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
				}

				// Populate the popup and set its coordinates based on the feature found.
				popup
				.setLngLat(coordinates)
				.setHTML(name + video + description)
				.addTo(map);
			});
		});

		function hideOverlay() {
			document.getElementById('overlay').style.display = 'none';
		}
	</script>

</body>
</html>